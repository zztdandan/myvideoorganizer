## 项目介绍
请帮我编写一个python项目以执行对视频文件夹的整理功能。该功能基于配置与命令行来灵活地进行文件夹整理，具有logging日志打印与保存功能
如果我的脚本运行在windows中，我整理的文件夹是映射到windows硬盘的smb服务的文件，如果我的脚本运行在linux中，整理的是nfs映射后的文件，如果在py中没有特殊的操作即可满足，那么这个介绍仅作为知识
## 功能介绍
共同要求：
1. 所有的操作功能，均按配置分为两种模式，第一种模式是在功能确认了要进行的操作后，在命令行输出操作的预览内容，由我进行YN确认，然后直接进行操作；第二种模式是，将操作功能输出为一个json文件，该文件的内容及命名规范等按照你方便读取的形式进行，然后使用这个操作功能的执行json操作函数（该函数能够读取json文件并和第一种模式进行同样操作）来进行操作；由于有这个设定，我建议应将识别，制定操作计划，以及执行操作的功能分开编写;
操作的预览内容，如果是层级的，以tree形式树形展示，但是json不是树形，可以直接命名为全路径名
2. 所有的文件夹删除，文件清理功能，并不是完全删除，而是将这些文件夹，文件移动到我设定的根目录的.delete文件夹内，目录层级结构和文件名还是维持原来，由我最后确认后手动处理（注意要帮我创建好对应的层级结构防止移不进去）
3. 所有


### 功能1-视频文件夹初步整理
该功能我的目的是识别某个根目录下的所有视频文件夹并清理不是视频文件夹的部分：
1. 具体整理哪个目录是配置中指定的，我需要整理该目录下所有的文件夹的内容包括子文件夹
2. 首先我需要判断这个文件夹是不是一个存有视频的文件夹，视频的后缀是配置式的，可以由我自行添加，先配置常规的所有视频格式。只有大于500M的视频被认为是我需要整理的视频，小于500M的就算后缀名符合匹配也不是我需求的合格视频文件夹（500M是我的一个配置）
3. 如果一个文件夹不是视频文件夹，而且它的所有子文件夹也都不是视频文件夹（这个判断是递归的，就是说多层文件夹只要有一个层级符合视频文件夹的定义那么这个文件夹以及它的所有父级都算是视频文件夹），那么这个文件夹将被标记即将删除
4. 按照共同要求进行删除处理
### 功能2-视频文件夹内部文件清理
目的是清除视频文件夹内除视频，视频匹配的信息、图片文件，其他文件均清理掉：
1. 与上面功能1一致，具体整理哪个目录是配置中指定的
2. 判断视频文件夹的原则也与上面功能1一致
3. 对于视频文件夹内的文件，有益的是这些文件——首先是视频本身，所有超过500m的文件都是有益的；
4. 其次是所有.nfo文件，这些文件如果有与视频至少前5个字符匹配的命名（具体多少个字符是配置的），那么就是有益的；
5. 对于所有图片文件（图片的后缀是常规后缀，可配置其他后缀补充），如果是无前缀的如下名字：poster,movie,folder,cover,fanart,banner,clearart,thumb,landscape,logo,clearlogo,disc,discart,keyart，（可配置）那么一定是有益的；
6. 如果是有前缀的，那么同上前缀与视频至少前5个字符匹配，也是有益的，其他图片是无益的
7. 其他所有格式的文件是无益的
8. 所有无益的文件，也同上，按照共同要求处理
### 功能3-视频文件重命名
1. 仍然是处理我配置的目录下的所有视频文件夹中的视频文件，对于视频文件夹与视频文件的判断规则同上
2. 对于一个视频文件夹内有多个视频文件的，需要进行分集命名，规则如下：
2.1 所有视频文件需符合前面对视频文件的定义才进行分集命名，其他视频文件不考虑在内
2.2 对于哪个视频文件是第一集哪个是最后一集，是按照文件名排序升序决定，顺序第一的就是第一集以此类推
2.3 重命名的规则是，从第一个字符开始，取这些视频文件所有相同的前缀字符作为分集命名的基础名字，所有不相同的字符（不包括文件后缀）全部清除，更换为-cd[order]，[order]是我配置中选择的其中一套规则，主要有3套规则可选，首先是1,2....的数字顺序，其次是A~Z的字母顺序，最后是01,02,...的两位数字顺序
3. 重命名的计划同上，按照共同要求处理
#### 功能4-视频文件夹移动且命名
该功能涉及到读取nfo具体内容来进行处理，先预留，待会再完善

## 其他编程规范
+ 所有函数及函数内部的逻辑均需要详细的标准规范的注解便于阅读
+ 你可以自行计划用多少次对话完成所有工程项目编写由我来执行，不必一定在一个对话中完成
+ 你可以自行进行代码结构及项目文件结构设定，我的唯一要求是按我的功能需求保持灵活性，尽量合并重复代码功能
+ 所有注解，回答解释全部是中文
+ 配置文件用python默认格式即可
+ 按标准项目方式规划，但是先不编写readme，而是我要求时再书写
+ 如果你认为有困难或疑惑，需要先提出，再进行后续的计划设计以及编写


下面是初步的项目设计思路与疑问，需要先确认这些内容后，再进行详细的项目结构搭建与代码编写。请您审阅并提出进一步需求或答复。

---

## 项目设计思路

1. **项目整体结构**  
   - 我们会以一个标准的 Python 项目来组织代码，至少包含以下部分：  
     1. 一个主入口脚本 (main.py 或者类似名称)，以便通过命令行或配置文件来执行主要功能。  
     2. 若干功能模块 (utils/operations/config/...)，分别放置通用工具函数、日志模块、配置加载模块以及对“功能1、功能2、功能3...”等逻辑的拆分实现。  
     3. 一个配置文件 (config.py 或者 YAML/JSON 等形式)，存放所有可配置信息，比如：  
        - 各种视频后缀名列表。  
        - 500MB、nfo 文件匹配前缀长度(默认5个字符)、图片文件常见后缀名列表及保留关键字列表(“poster”、“cover”……)等。  
        - 执行模式 (交互式预览 -> 确认执行 / 生成 JSON -> 再次读取 JSON 并执行)。  
        - 重命名方案 (-cd1, -cd2, 或者 A, B, C，或 01, 02, 03)。  
     4. 一个日志文件记录系统过程。  

2. **主要执行逻辑**  
   1. 从配置中获取目标根目录。  
   2. 递归扫描此目录，识别哪些是视频文件夹（功能1中的规则：视频文件(>500MB)或其子文件夹存在视频文件均视为视频文件夹）。  
   3. 处理“非视频文件夹或无意义文件夹”的移动(“假删除”到 .delete 目录)。  
   4. 对“已判断为视频文件夹”的各文件执行内部文件清理（功能2），只保留对我们有意义的文件：  
      - 超过 500MB 的视频  
      - 符合前缀匹配的 .nfo  
      - 符合前缀或特定关键字的图片文件  
      - 其余移动到 .delete 目录  
   5. 视频文件存在多个时，执行视频重命名（功能3）。规则：  
      - 找出公共前缀，后续不一致部分统一改为 “-cd[序号]” 或者配置指定(1, 2, 3...)、(A, B, C...)、(01, 02, 03...)。  
   6. 对所有操作：  
      - 在命令行中以 tree 结构或其他可视化方式输出“预览信息”，用户做 Y/N 确认 (模式1)； 或者  
      - 生成 JSON 文件，记录所有操作计划，然后可读取此 JSON 文件执行实际操作 (模式2)。  
   7. 日志系统：  
      - 在命令行打印日志信息以便观察，也写入日志文件便于复查。  

3. **项目实现要点**  
   1. “删除”操作实际是移动到“.delete”文件夹，并且保留原来的层级结构。  
   2. 要防止出现“.delete”文件夹移动到自己内部的递归错误，要做一些简单的路径检查(若该文件夹本身就是.delete 子目录，应跳过处理)。  
   3. JSON 操作计划格式需要简单清晰，我们可以自行设计。最重要的是：  
      - JSON 中要有文件的全路径与对应的操作动作 (move / rename / ignore...)。  
      - 读取 JSON 后，按相同逻辑执行操作并记录日志。  

4. **疑问 / 需确认的点**  
   1. 日志的输出等级：我们默认会使用 Python 标准库 logging，包含 DEBUG/INFO/WARNING/ERROR 等等级。是否有额外需求，比如在 JSON 中也输出日志？  
   2. 移动到 .delete 文件夹时，是否需要区分按日期或其他层级来存放？还是仅仅把原始路径层级复制一份到 .delete 下即可？  
   3. 是否需要做任何额外的视频信息校验 (如读取部分媒体信息等)，还是仅通过文件扩展名与大小判断？  
   4. 功能4 涉及到读取 .nfo 的更多内容 (如影片名称、年代标签等) 并改名或移动文件夹，暂时未展开，后续是否集中在下一个阶段设计？  

---

**请您回答或补充这些疑问**，或确认无误后，我将据此进行更详细的项目结构与代码编写。  
如果一切问题都已清晰，我会在下一个回复中开始提交项目的目录结构与核心代码示例。


1. json中存储操作，日志不要存
2. 需要区分日期或其他层级，每个日期新建一个目录存到新层级
3. 不需要，文件扩展名与大小即可，记得这些要都可配置
4. 对的
补充其他要求：
1. 每个功能是独立触发的，而不是一次性执行1，2，3，4功能，你可以提供命令行或简单http入口来让我触发
2. 配置文件使用config.py形式，要求可以快速切换多套配置，如dev1,dev2,release，配置间可以继承覆盖，暂时只有一套配置


以下是基于您最新答复所做的更新设计方案。我将先给出项目结构说明，然后在后续回复里为每个核心功能提供较为完整的实现示例代码。这样既能保证项目清晰可循，也能保证后续维护或调整时更为灵活。

---

## 项目结构方案

```
myvideoorganizer/
├── config.py               # 配置文件，支持多套配置
├── main.py                 # 项目入口，可通过命令行或HTTP触发执行
├── requirements.txt        # 依赖包(如有需要)
├── logs/                   # 日志文件目录
│   └── organizer.log
├── core/
│   ├── scanner.py          # 功能1 & 功能2等可能共用的扫描工具
│   ├── planner.py          # 负责“识别 + 生成操作计划”的逻辑
│   ├── executor.py         # 负责“读取操作文件(json) + 执行操作”的逻辑
│   ├── renamer.py          # 功能3 - 重命名相关逻辑
│   ├── helpers.py          # 通用工具函数(如大小转换、路径处理、tree视图生成等)
│   └── logger.py           # 日志封装(基于 Python logging)
└── server/
    └── http_server.py      # (可选) 简易HTTP触发入口，实现功能1/2/3/4的API触发
```

> 说明：  
> 1. `config.py` 中支持多套配置，通过“`ENV=dev1 python main.py`”或命令行参数指定当前生效的配置。  
> 2. 日志会写到 `logs/organizer.log`，同时也在命令行中打印。  
> 3. 需要将生成的操作计划(例如“移动某文件到 .delete/20250106/xxx”)存储为 JSON 文件；但日志不放到 JSON 中。日志只单独存放在日志文件里并打印到控制台即可。  
> 4. 移动到 “.delete” 时，要区分日期或其他层级。例如可创建 “.delete/20250106/原来相对路径...”。  
> 5. 每个功能(1,2,3,4)可以独立触发：  
>    - 用户可在命令行输入“python main.py func1 --mode=preview”或者“python main.py func1 --mode=json ...”等；或通过 HTTP 触发。  
>    - 每个功能内部仍可使用共同的 Planner / Executor 在不同模式下去生成或执行操作。

---

## 核心流程概述

1. 选择功能入口，比如用户在命令行输入 `python main.py func1 --mode=preview`：  
   1. 加载配置 (config.py 中选定的 ENV)。  
   2. 调用 Planner (planner.py) 对指定目录执行扫描并生成“操作计划”(Python对象或列表)。  
   3. 如果是 `preview` 模式，则：  
      - 以 tree 形式输出操作计划的预览信息到命令行。  
      - 等待用户手动确认(Y/N)。如确认，则立即执行；否则放弃。  
   4. 如果是 `json` 模式，则：  
      - 将操作计划的内容写入一个 JSON 文件(命名规则可自行定，如 `operation_plan_YYYYMMDD_HHMM.json`)。  

2. 如果用户使用第二种模式(先生成 JSON)，则会有一个独立的操作命令，比如 `python main.py exec --json=xxx.json`：  
   1. 读取 JSON 文件到内存，得到操作计划。  
   2. 调用 Executor (executor.py) 执行操作计划，移动文件或重命名等。  
   3. 过程中记录日志，但不写入 JSON。  

3. 日志系统：  
   - 在 `core/logger.py` 中统一封装 Python logging。  
   - 项目启动时初始化日志器(`logging.getLogger(__name__)`)，日志文件输出到 `logs/organizer.log`，同时在控制台打印。  

4. 与日期相关的 `.delete` 文件夹结构：  
   - 当执行“移动”操作时，假设当日为 2025-01-06，会在根目录下创建 “.delete/20250106/” 作为当天删除对象的目标根目录。  
   - 继续保持原层级，比如原文件是 `/myvideos/abc/test.mp4`，移动后为：  
     `.delete/20250106/myvideos/abc/test.mp4`  

5. 配置文件 `config.py` 示例：  
   - 多套配置类(如 `DevConfig`, `ReleaseConfig`)，但目前只留一个 `DevConfig`。  
   - 配置项包括：视频后缀、最小识别大小(500MB或其他)、可保留的图片后缀、图片关键字、nfo 的匹配前缀长度等等。  
   - 配置项中也可包含 JSON 生成的默认目录或命名规则等。  

---

## 下阶段计划

1. 在下一条回复里，我将给出一个最小可运行的示例，包括：  
   - config.py (仅有一个默认配置的示例)  
   - logger.py (日志封装)  
   - planner.py (以功能1/2/3 为例，生成操作计划)  
   - executor.py (执行 JSON 中的操作)  
   - main.py (命令行解析 + HTTP 触发入口的雏形)  
2. 每个功能的核心算法（例如如何判断视频文件夹、如何过滤有益/无益文件、如何生成重命名方案等），会放在 `planner.py` 或者单独拆分到 `scanner.py` / `renamer.py` 中，以示例形式展示。  

这样通过几次回复，完整拼起来后，就能得到一个可运行的工程原型。  
如果对以上结构或流程有任何调整需求，请及时告诉我。否则我会在后续回复中开始提供示例代码。


我需要和你约定正确的操作json格式，我希望json中不出现中文，仅是一个数组存储操作列表即可，你可以给出你的规范并由我确认


下面给出一份“操作计划 JSON 格式”推荐规范，供讨论和确认。该 JSON 文件中仅包含操作信息，不带日志文本，同时不出现任何中文内容。整体是一个数组，数组中每个元素（对象）对应一条操作计划，示例如下：

```json
[
  {
    "function": "func1",
    "action": "MOVE",
    "source": "/mnt/videos/example_folder",
    "destination": "/mnt/videos/.delete/20250106/example_folder"
  },
  {
    "function": "func2",
    "action": "RENAME",
    "source": "/mnt/videos/another_folder/old_name.mp4",
    "destination": "/mnt/videos/another_folder/new_name-cd1.mp4"
  }
]
```

## 字段说明 (英文说明，JSON 不包含中文)

1. "function" (string, optional):  
   - Which functionality generated this plan item, e.g. "func1", "func2", "func3", "func4".
   - Though optional, it helps identify the operation’s origin.

2. "action" (string, required):  
   - The type of operation. Possible values:  
     - "MOVE": Move/relocate the file/folder to the specified "destination".  
       - Note: For “delete” in this project’s context, we actually do a MOVE to “.delete/…”.  
     - "RENAME": Rename the file to the specified "destination".  
   - Other actions like "SKIP" can be added if needed in the future.

3. "source" (string, required):  
   - The absolute or full path of the file/folder to be operated on.

4. "destination" (string, required for MOVE/RENAME):  
   - The absolute or full path after the MOVE/RENAME.
   - For a “delete” approach, the "destination" path typically starts with ".delete/<date>/…".

示例要点:  
- JSON 根元素是一个数组。  
- 数组中的每个对象必须至少包含 "action"、"source"、"destination" 三个字段；"function" 用于可读性或后续调试。  
- 所有文本必须是英文或文件路径等，无中文字符。  
- 不携带日志或状态信息，只负责描述操作计划本身。  

如果以上格式满足需求，请您确认。确认后，就可在后续实现中按照此规范生成与解析操作计划文件。

确认，按你的计划开始正式编写

